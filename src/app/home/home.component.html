<div class="container">
  <header class="header">
    <div class="logo-container">
       <h1>SoccerHub⚽</h1>
    </div>
    <button (click)="cerrarSesion()" class="logout-button">Cerrar sesión</button>
  </header>

  <section class="tweet-box">
    <textarea [(ngModel)]="tweetText" placeholder="Publica un tweet de algún Futbolista" class="tweet-textarea"></textarea>
    <button (click)="addTweet()" class="tweet-button">Tweet</button>
  </section>

  <section class="tweet-list">
    <div *ngFor="let tweet of tweets" class="tweet-card">
      <div class="tweet-header">
        <p class="username"><strong> Publicado por {{ tweet.username }}</strong></p>
        <p class="date">{{ tweet.fechaCreacion | date: 'short' }}</p>
      </div>
      <p class="content">{{ tweet.contenido }}</p>

      <!-- Reacciones -->
      <div class="reacciones">
        <button (click)="addReaction(tweet.id, 'LIKE')" class="reaction-btn">👍 Like</button>
        <button (click)="addReaction(tweet.id, 'LOVE')" class="reaction-btn">❤️ Love</button>
        <button (click)="addReaction(tweet.id, 'SAD')" class="reaction-btn">😢 Sad</button>
        <button (click)="addReaction(tweet.id, 'ANGRY')" class="reaction-btn">😡 Angry</button>
        <button (click)="addReaction(tweet.id, 'GOAT')" class="reaction-btn">🐐 GOAT</button>
      </div>

      <!-- Mostrar el emoji con más reacciones -->
      <p *ngIf="reactions[tweet.id]">
        <strong>Reacción más popular:</strong> {{ getMostReactedEmoji(tweet.id) }}
      </p>

      <!-- Botón para mostrar/ocultar los comentarios -->
      <button (click)="toggleComments(tweet.id)" *ngIf="commentsVisibility[tweet.id] === undefined || commentsVisibility[tweet.id]">
        Ver comentarios
      </button>
      <button (click)="toggleComments(tweet.id)" *ngIf="commentsVisibility[tweet.id] === false ">
        Ocultar comentarios
      </button>

      <!-- Mostrar comentarios solo si commentsVisibility[tweet.id] es true -->
      <div *ngIf="commentsVisibility[tweet.id]" class="comentarios-list">
        <div *ngFor="let comentario of comments[tweet.id]" class="comentario">
          <div class="comentario-header">
            <strong>{{ comentario.autor }}</strong> 
            <span class="fecha">{{ comentario.fechaCreacion | date: 'short' }}</span>
          </div>
            <p class="comentario-texto">{{ comentario.texto }}</p>
        </div>
      </div>

      <!-- Formulario para agregar comentario -->
      <div class="comentario-form">
        <textarea [(ngModel)]="commentText[tweet.id]" placeholder="Escribe tu comentario..." rows="3"></textarea>
        <button (click)="addComment(tweet.id)">Comentar</button>
      </div>

      <div class="comentarios-separator"></div>
    </div>

    <div #scrollAnchor></div>
    <p *ngIf="loading" class="loading">Cargando más tweets...</p>
  </section>

  <footer class="footer">by aldair</footer>
</div>
